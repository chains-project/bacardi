20a21
> 
24a26
> 
43c45,47
<             RpcContext.getContext().setFuture(asyncRpcResult);
---
>             // Convert AsyncRpcResult to CompletableFuture if necessary
>             CompletableFuture<Object> futureResult = CompletableFuture.completedFuture(asyncRpcResult.getValue());
>             RpcContext.getContext().setFuture(futureResult);
45c49
<             FutureContext.getContext().setCompatibleFuture(asyncRpcResult);
---
>             FutureContext.getContext().setCompatibleFuture(futureResult);
