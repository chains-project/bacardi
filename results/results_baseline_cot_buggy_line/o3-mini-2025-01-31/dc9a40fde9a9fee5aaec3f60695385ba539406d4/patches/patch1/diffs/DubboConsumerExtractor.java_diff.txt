8c8,11
< import org.apache.dubbo.rpc.*;
---
> import org.apache.dubbo.rpc.AsyncRpcResult;
> import org.apache.dubbo.rpc.Invocation;
> import org.apache.dubbo.rpc.RpcContext;
> import org.apache.dubbo.rpc.RpcInvocation;
9a13,15
> import org.apache.dubbo.rpc.FutureContext;
> 
> import java.util.concurrent.CompletableFuture;
18c24
<     public void record(Result result) {
---
>     public void record(org.apache.dubbo.rpc.Result result) {
20a27
>     
24a32
>     
43c51,60
<             RpcContext.getContext().setFuture(asyncRpcResult);
---
>             
>             // Wrap AsyncRpcResult into a CompletableFuture as required by the updated API.
>             CompletableFuture<Object> future = new CompletableFuture<>();
>             if (asyncRpcResult.getException() != null) {
>                 future.completeExceptionally(asyncRpcResult.getException());
>             } else {
>                 future.complete(asyncRpcResult.getValue());
>             }
>             
>             RpcContext.getContext().setFuture(future);
45c62
<             FutureContext.getContext().setCompatibleFuture(asyncRpcResult);
---
>             FutureContext.getContext().setCompatibleFuture(future);
